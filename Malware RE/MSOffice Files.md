## Tools
- Libreoffice
	- handles .docx files in linux
- exiftool
	- extracts and manipulates metadata
	- finds file origin and history
-  oletools
		- *object linking and embedding*
		- suite of tools to analyze office and other file types
		- can extract macros, embedded objects, and potentially malicious content

## Methodology
In no particular order these are helpful steps to cover
- Pull File Hashes
- Look in VT / MalwareBazaar for hash 
- Exiftool on the files
	- `exiftool <filename>`
- Running `strings` on the file for interesting output
- oletools to analyze specific filetypes
	- can pull and analyze macros from documents, easiest way to see source code assuming it is not obfuscated
- you can run `unzip` to extract nested files easily
	- FlareVM doesn't have `unzip`, but you can also change the file extension of the office document to `.zip` and open it in explorer


## MS Office Files
Come in three types of files:
- OLE2 (Object Linking and Embedding)
- OOXML (Open Office XML)
- RTF (Rich Text Format)

### Useful Things to Remember
- in a document that you've unzipped, you can navigate to `_rels > settings.xml.rels` and look in the target field
	- relevent for OOXML files, as they cannot natively contain VBA macros
	- malicious actors can use this as a *remote template injection attack*


# Object Linking and Embedding (OLE)
You can think of OLE2 as a file system in a zip container
- also referred to as *structured storage* (SS) since it's made up of files and folders
- in the context of OLE2, files are referred to as streams and folders are referred to as storages
![[Pasted image 20250812160231.png]]

On the left here we see a .docx file unzipped on the left and in [SSView](https://sourceforge.net/projects/ssview/) on the right
- OLE2 files are recognized by either:
	- file extension - think .doc, .xls, .ppt, etc
	- magic bytes of the files
		- **D0 CF 11 E**0 A1 B1 1A E1
		- the first 7 characters  spell out *DOCFILE*
OLE2 files support macros

---

# Rich Text Format

In the context of MS Office document analysis:
- macros are not supported by RTF
- OLE object embedding is possible
- RTF encodes text, graphics, and objects
- RTF files have the ability to automatically extract embedded objects to the userâ€™s *%TEMP%* directory, which threat actors may abuse to embed malicious scripts.
### Tools
- **rtfdump**
	- python script to dump rtf objects
	- included in FlareVM
	- flag `-F` looks through and gives simple output of each decoded objects
	- we can use `-d` to see which streams hold objects:
	- and we can then save that data to a file by indicating the data stream with `rtfdump -s <#> -d filename.rtf > payload.bin`
- **rtfobj**
	- part of oletools
	- will extract objects and be easily viewable

---

# Open Office XML
New format for MS Office documents since 2007.
- Made up of .XML files that are compressed as a ZIP file
- has zip file magic bytes `50 4B 03 04`
- identified by extensions `doc[x|m], xls[x|m], ppt[x|m]` and so on
- supports OLE2 object embedding 